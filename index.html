<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Salário Final (com Total Geral)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #1a202c; /* Tailwind gray-900 */
            color: #e2e8f0; /* Tailwind gray-200 */
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #2d3748; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #4a5568; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #718096; }

        details summary { list-style: none; }
        details summary::-webkit-details-marker { display: none; }
        details summary::before {
            content: '►'; margin-right: 0.5rem; transition: transform 0.2s ease-in-out;
            color: #90cdf4; display: inline-block;
        }
        details[open] summary::before { transform: rotate(90deg); }
        .font-inter { font-family: 'Inter', sans-serif; }
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        function App() {
            const [hourlyRate, setHourlyRate] = React.useState(12.94);
            const [selectedYear, setSelectedYear] = React.useState(new Date().getFullYear().toString());
            const [yearlyPeriods, setYearlyPeriods] = React.useState([]);
            const [annualTotalSalary, setAnnualTotalSalary] = React.useState(0);
            const [grandTotal, setGrandTotal] = React.useState(0); // Novo estado para o total geral
            const [errorMessage, setErrorMessage] = React.useState('');
            const [showMessageBox, setShowMessageBox] = React.useState(false);
            const [infoMessageBox, setInfoMessageBox] = React.useState({show: false, title: '', content: ''});


            const monthNames = React.useMemo(() => [
                'Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ], []);

            const formatDate = React.useCallback((dateInput) => {
                let d;
                if (dateInput instanceof Date) {
                    d = new Date(Date.UTC(dateInput.getFullYear(), dateInput.getMonth(), dateInput.getDate()));
                } else if (typeof dateInput === 'string' && dateInput.match(/^\d{4}-\d{2}-\d{2}$/)) {
                    const parts = dateInput.split('-');
                    d = new Date(Date.UTC(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2])));
                } else {
                    const tempDate = new Date(dateInput);
                    if (!isNaN(tempDate.getTime())) {
                         d = new Date(Date.UTC(tempDate.getFullYear(), tempDate.getMonth(), tempDate.getDate()));
                    } else { return ''; }
                }
                if (isNaN(d.getTime())) return '';
                const year = d.getUTCFullYear();
                const month = String(d.getUTCMonth() + 1).padStart(2, '0');
                const day = String(d.getUTCDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }, []);

            const getEasterSunday = React.useCallback((year) => {
                const a = year % 19; const b = Math.floor(year / 100); const c = year % 100;
                const d = Math.floor(b / 4); const e = b % 4; const f = Math.floor((b + 8) / 25);
                const g = Math.floor((b - f + 1) / 3); const h = (19 * a + b - d - g + 15) % 30;
                const i = Math.floor(c / 4); const k = c % 4; const l = (32 + 2 * e + 2 * i - h - k) % 7;
                const m = Math.floor((a + 11 * h + 22 * l) / 451);
                const month = Math.floor((h + l - 7 * m + 114) / 31);
                const day = ((h + l - 7 * m + 114) % 31) + 1;
                return new Date(year, month - 1, day);
            }, []);

            const getBrazilianHolidays = React.useCallback((year) => {
                const holidays = new Set(); const easter = getEasterSunday(year);
                holidays.add(formatDate(new Date(year, 0, 1))); holidays.add(formatDate(new Date(year, 3, 21)));
                holidays.add(formatDate(new Date(year, 4, 1))); holidays.add(formatDate(new Date(year, 8, 7)));
                holidays.add(formatDate(new Date(year, 9, 12))); holidays.add(formatDate(new Date(year, 10, 2)));
                holidays.add(formatDate(new Date(year, 10, 15))); holidays.add(formatDate(new Date(year, 11, 25)));
                const carnivalDate = new Date(easter.getTime()); carnivalDate.setDate(easter.getDate() - 47); holidays.add(formatDate(carnivalDate));
                const goodFridayDate = new Date(easter.getTime()); goodFridayDate.setDate(easter.getDate() - 2); holidays.add(formatDate(goodFridayDate));
                const corpusChristiDate = new Date(easter.getTime()); corpusChristiDate.setDate(easter.getDate() + 60); holidays.add(formatDate(corpusChristiDate));
                return holidays;
            }, [getEasterSunday, formatDate]);

            const initializePeriods = React.useCallback((yearToInitStr) => {
                const currentYear = parseInt(yearToInitStr, 10);
                if (isNaN(currentYear) || currentYear < 1900 || currentYear > 2100) {
                    setErrorMessage("Por favor, insira um ano válido (1900-2100).");
                    setShowMessageBox(true);
                    setYearlyPeriods([]);
                    setAnnualTotalSalary(0);
                    setGrandTotal(0);
                    return;
                }

                const holidays = getBrazilianHolidays(currentYear); const periods = [];
                for (let i = 0; i < 12; i++) {
                    const salaryMonthName = monthNames[i];
                    const periodStart = new Date(currentYear, i - 2, 21); const periodEnd = new Date(currentYear, i - 1, 20);
                    const daysInPeriod = []; let currentDateIter = new Date(periodStart.getTime());
                    while (currentDateIter <= periodEnd) {
                        const dayOfWeek = currentDateIter.getDay(); const isWeekday = dayOfWeek !== 0 && dayOfWeek !== 6;
                        const formattedDateStr = formatDate(currentDateIter); const isHoliday = holidays.has(formattedDateStr);
                        daysInPeriod.push({ date: formattedDateStr, hours: (isWeekday && !isHoliday) ? 5 : 0, isWeekday: isWeekday, isHoliday: isHoliday });
                        currentDateIter.setDate(currentDateIter.getDate() + 1);
                    }
                    periods.push({
                        id: `${currentYear}-${i}`, monthName: salaryMonthName, periodStart: formatDate(periodStart), periodEnd: formatDate(periodEnd),
                        days: daysInPeriod, monthlyTotalHours: 0, monthlySalary: 0, isExpanded: false, quickFillHours: 5
                    });
                }
                setYearlyPeriods(periods);
                setAnnualTotalSalary(0); 
                setGrandTotal(0);
                setErrorMessage(''); setShowMessageBox(false);
            }, [monthNames, getBrazilianHolidays, formatDate]);

            React.useEffect(() => {
                initializePeriods(selectedYear);
            }, [selectedYear, initializePeriods]);

            const handleHourlyRateChange = (e) => {
                const value = parseFloat(e.target.value);
                const newHourlyRate = isNaN(value) || value < 0 ? 0 : value;
                setHourlyRate(newHourlyRate);
                setYearlyPeriods(prev => prev.map(p => ({ ...p, monthlySalary: 0, monthlyTotalHours: 0 })));
                setAnnualTotalSalary(0); 
                setGrandTotal(0);
            };
            
            const handleSelectedYearChange = (e) => {
                const yearValue = e.target.value;
                setSelectedYear(yearValue);
                // initializePeriods será chamado pelo useEffect
            };

            const handleDailyHoursChange = React.useCallback((periodIndex, dayIndex, hoursStr) => {
                const hours = parseFloat(hoursStr);
                const newHours = isNaN(hours) || hours < 0 ? 0 : (hours > 24 ? 24 : hours);
                setYearlyPeriods((prevPeriods) => {
                    const newPeriods = [...prevPeriods];
                    const periodToUpdate = { ...newPeriods[periodIndex] };
                    const newDays = [...periodToUpdate.days];
                    newDays[dayIndex] = { ...newDays[dayIndex], hours: newHours };
                    periodToUpdate.days = newDays;
                    periodToUpdate.monthlyTotalHours = 0; periodToUpdate.monthlySalary = 0;   
                    newPeriods[periodIndex] = periodToUpdate;
                    return newPeriods;
                });
                setAnnualTotalSalary(0); 
                setGrandTotal(0);
            }, []);

            const toggleMonthExpansion = React.useCallback((periodIndex) => {
                setYearlyPeriods(prevPeriods => 
                    prevPeriods.map((p, idx) => idx === periodIndex ? { ...p, isExpanded: !p.isExpanded } : p)
                );
            }, []);

            const handleQuickFillHoursChange = React.useCallback((periodIndex, hoursStr) => {
                const hours = parseFloat(hoursStr);
                const newQuickFillHours = isNaN(hours) || hours < 0 ? 0 : (hours > 24 ? 24 : hours);
                setYearlyPeriods(prevPeriods => 
                    prevPeriods.map((p, idx) => idx === periodIndex ? { ...p, quickFillHours: newQuickFillHours } : p)
                );
            }, []);

            const applyQuickFill = React.useCallback((periodIndex) => {
                setYearlyPeriods(prevPeriods => {
                    const newPeriods = [...prevPeriods];
                    const periodToUpdate = { ...newPeriods[periodIndex] };
                    const fillHours = periodToUpdate.quickFillHours;
                    const updatedDays = periodToUpdate.days.map(day => 
                        (day.isWeekday && !day.isHoliday) ? { ...day, hours: fillHours } : day
                    );
                    periodToUpdate.days = updatedDays;
                    periodToUpdate.monthlyTotalHours = 0; periodToUpdate.monthlySalary = 0;   
                    newPeriods[periodIndex] = periodToUpdate;
                    return newPeriods;
                });
                setAnnualTotalSalary(0); 
                setGrandTotal(0);
            }, []);

            const calculateMonthlySalary = React.useCallback((periodIndex) => {
                if (!hourlyRate || hourlyRate <= 0) {
                    setErrorMessage('Por favor, insira uma taxa horária válida e maior que zero.'); setShowMessageBox(true); return;
                }
                let newOverallAnnualTotal = 0;
                setYearlyPeriods(prevPeriods => {
                    const newPeriods = prevPeriods.map((p, idx) => {
                        if (idx === periodIndex) {
                            let currentMonthlyTotalHours = 0;
                            p.days.forEach(day => { currentMonthlyTotalHours += day.hours; });
                            const currentMonthlySalary = currentMonthlyTotalHours * hourlyRate;
                            const updatedPeriod = { ...p, monthlyTotalHours: currentMonthlyTotalHours, monthlySalary: currentMonthlySalary };
                            newOverallAnnualTotal += currentMonthlySalary;
                            return updatedPeriod;
                        }
                        newOverallAnnualTotal += p.monthlySalary || 0; 
                        return p;
                    });
                    return newPeriods;
                });
                setAnnualTotalSalary(newOverallAnnualTotal);
                setGrandTotal(0); // Resetar total geral pois um componente mudou
                setErrorMessage(''); setShowMessageBox(false);
            }, [hourlyRate]);

            const calculateAnnualSalary = () => {
                if (!hourlyRate || hourlyRate <= 0) {
                    setErrorMessage('Por favor, insira uma taxa horária válida e maior que zero.'); setShowMessageBox(true); setAnnualTotalSalary(0); return;
                }
                const monthsNotCalculated = yearlyPeriods.some(p => p.days.some(d => d.hours > 0) && p.monthlySalary === 0);
                if (monthsNotCalculated) {
                    setErrorMessage('Calcule o salário de todos os meses com horas antes do total anual.'); setShowMessageBox(true); return;
                }
                let totalAnnual = 0;
                const updatedYearlyPeriodsWithFinalSalaries = yearlyPeriods.map(p => {
                    let currentMonthlyTotalHours = 0;
                    p.days.forEach(day => { currentMonthlyTotalHours += day.hours; });
                    const monthlySal = currentMonthlyTotalHours * hourlyRate;
                    totalAnnual += monthlySal;
                    return { ...p, monthlyTotalHours: currentMonthlyTotalHours, monthlySalary: monthlySal };
                });
                setYearlyPeriods(updatedYearlyPeriodsWithFinalSalaries);
                setAnnualTotalSalary(totalAnnual);
                setGrandTotal(0); // Resetar total geral pois um componente mudou
                setErrorMessage(''); setShowMessageBox(false);
            };

            const resetAllCalculations = React.useCallback(() => {
                initializePeriods(selectedYear); 
                setHourlyRate(12.94); 
                setAnnualTotalSalary(0);
                setGrandTotal(0);
                setErrorMessage(''); setShowMessageBox(false);
                setInfoMessageBox({show: false, title: '', content: ''});
            }, [selectedYear, initializePeriods]); 

            const getAverageCalculatedSalary = () => {
                const calculatedSalaries = yearlyPeriods.filter(p => p.monthlySalary > 0).map(p => p.monthlySalary);
                if (calculatedSalaries.length === 0) {
                    return 0;
                }
                return calculatedSalaries.reduce((sum, sal) => sum + sal, 0) / calculatedSalaries.length;
            };

            const calculateVacation = () => {
                const averageMonthlySalary = getAverageCalculatedSalary();
                if (averageMonthlySalary === 0) {
                    setErrorMessage('Calcule alguns salários mensais primeiro para estimar as férias.');
                    setShowMessageBox(true);
                    return;
                }

                const oneThirdVacation = averageMonthlySalary / 3;
                const totalVacationPayBrute = averageMonthlySalary + oneThirdVacation;

                const content = (
                    React.createElement('div', null,
                        React.createElement('p', {className: "mb-2"}, `Salário Médio Mensal Considerado: R$ ${averageMonthlySalary.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`),
                        React.createElement('p', {className: "mb-2"}, `Adicional de 1/3: R$ ${oneThirdVacation.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`),
                        React.createElement('p', {className: "text-lg font-semibold mb-2"}, `Total Bruto de Férias: R$ ${totalVacationPayBrute.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`),
                        React.createElement('p', {className: "text-xs text-gray-400 mt-4"}, `Nota: Este é um valor bruto estimado. Descontos como INSS e IRRF serão aplicados sobre este valor. Consulte um profissional para cálculos exatos.`)
                    )
                );
                setInfoMessageBox({show: true, title: 'Estimativa de Férias', content: content});
                setErrorMessage(''); setShowMessageBox(false);
            };

            const calculateThirteenth = (proportionalMonths = 12) => {
                const averageMonthlySalary = getAverageCalculatedSalary();
                if (averageMonthlySalary === 0) {
                     setErrorMessage('Calcule alguns salários mensais primeiro para estimar o 13º.');
                    setShowMessageBox(true);
                    return { baseSalary: 0, thirteenthTotal: 0 };
                }

                const thirteenthTotalBrute = (averageMonthlySalary / 12) * proportionalMonths;
                
                if (proportionalMonths === 12) { // Só mostra o modal se for o cálculo completo
                    const content = (
                        React.createElement('div', null,
                            React.createElement('p', {className: "mb-2"}, `Salário Médio Mensal Considerado (Base): R$ ${averageMonthlySalary.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`),
                            React.createElement('p', {className: "text-lg font-semibold mb-2"}, `Total Bruto Estimado do 13º Salário (${proportionalMonths}/12 avos): R$ ${thirteenthTotalBrute.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`),
                            React.createElement('p', {className: "text-sm text-gray-300 mt-3 mb-1"}, `Parcelamento (Comum para 12/12 avos):`),
                            React.createElement('ul', {className: "list-disc list-inside text-sm text-gray-400"},
                                React.createElement('li', null, `1ª Parcela (até Novembro): ~50% do valor bruto, sem descontos. (Aprox. R$ ${(averageMonthlySalary/2).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })})`), // Para 12/12 avos
                                React.createElement('li', null, `2ª Parcela (até Dezembro): Restante, com descontos de INSS e IRRF aplicados sobre o valor total.`)
                            ),
                            React.createElement('p', {className: "text-xs text-gray-400 mt-4"}, `Nota: Este é um valor bruto estimado. O cálculo exato pode variar. Consulte um profissional para cálculos exatos.`)
                        )
                    );
                    setInfoMessageBox({show: true, title: `Estimativa de 13º Salário (${proportionalMonths}/12 avos)`, content: content});
                }
                setErrorMessage(''); setShowMessageBox(false);
                return { baseSalary: averageMonthlySalary, thirteenthTotal: thirteenthTotalBrute };
            };
            
            const calculateGrandTotal = () => {
                const sumMonthlySalaries = yearlyPeriods.reduce((acc, p) => acc + (p.monthlySalary || 0), 0);

                if (sumMonthlySalaries === 0) {
                    setErrorMessage('Calcule ao menos um salário mensal para estimar o total geral.');
                    setShowMessageBox(true);
                    return;
                }

                const averageSalary = getAverageCalculatedSalary();
                if (averageSalary === 0) { // Redundante se sumMonthlySalaries > 0, mas seguro
                    setErrorMessage('Não foi possível calcular a média salarial para férias e 13º.');
                    setShowMessageBox(true);
                    return;
                }

                const vacationBrute = averageSalary + (averageSalary / 3);
                const thirteenthProportionalBrute = (averageSalary / 12) * 8; // 8/12 avos (até Agosto)

                const currentGrandTotal = sumMonthlySalaries + vacationBrute + thirteenthProportionalBrute;
                setGrandTotal(currentGrandTotal);

                const content = (
                    React.createElement('div', {className: "space-y-2"},
                        React.createElement('p', null, 
                            React.createElement('strong', null, "Soma dos Salários Mensais Calculados: "), 
                            `R$ ${sumMonthlySalaries.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
                        ),
                        React.createElement('p', null, 
                            React.createElement('strong', null, "Estimativa Bruta de Férias (Média + 1/3): "), 
                            `R$ ${vacationBrute.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
                        ),
                        React.createElement('p', null, 
                            React.createElement('strong', null, "Estimativa Bruta do 13º (Proporcional 8/12 avos): "), 
                            `R$ ${thirteenthProportionalBrute.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
                        ),
                        React.createElement('hr', {className: "my-3 border-gray-600"}),
                        React.createElement('p', {className: "text-xl font-bold text-green-400"}, 
                            React.createElement('strong', null, "Total Geral Estimado (Bruto): "), 
                            `R$ ${currentGrandTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
                        ),
                        React.createElement('p', {className: "text-xs text-gray-400 mt-4"}, `Nota: Todos os valores são brutos e estimativas. Descontos não foram aplicados. Consulte um profissional para cálculos exatos.`)
                    )
                );
                setInfoMessageBox({show: true, title: 'Estimativa do Total Geral (até Agosto)', content: content});
                setErrorMessage(''); setShowMessageBox(false);
            };


            const MessageBox = ({ message, onClose, type = "error" }) => {
                const bgColor = type === "error" ? "bg-red-500" : "bg-blue-500";
                const titleColor = type === "error" ? "text-red-400" : "text-blue-300";
                const borderColor = type === "error" ? "border-red-500" : "border-blue-500";

                return (
                    React.createElement('div', {className: "fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4"},
                        React.createElement('div', {className: `bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full border ${borderColor}`},
                            message.title && React.createElement('h3', {className: `text-xl font-bold ${titleColor} mb-3 text-center`}, message.title),
                            typeof message.content === 'string' ? 
                                React.createElement('p', {className: `text-lg ${type === "error" ? "text-red-400" : "text-gray-200"} mb-4 text-center`}, message.content) :
                                React.createElement('div', {className: "text-gray-200 mb-4 text-left"}, message.content),
                            React.createElement('button', {
                                onClick: onClose,
                                className: `w-full mt-4 px-6 py-2 ${bgColor} text-white rounded-md hover:opacity-90 focus:outline-none focus:ring-2 ${type === "error" ? "focus:ring-red-400" : "focus:ring-blue-400"} focus:ring-opacity-50 transition duration-200`
                            }, "Fechar")
                        )
                    )
                );
            };


            return (
                React.createElement('div', {className: "min-h-screen bg-gray-900 text-gray-100 p-4 sm:p-8 flex flex-col items-center justify-start font-inter"},
                    React.createElement('div', {className: "bg-gray-800 p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-4xl border border-gray-700"},
                        React.createElement('h1', {className: "text-3xl sm:text-4xl font-extrabold text-center text-blue-400 mb-8"}, "Calculadora de Salário Final"),
                        
                        React.createElement('div', {className: "grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},
                            React.createElement('div', {className: "flex flex-col"},
                                React.createElement('label', {htmlFor: "hourlyRate", className: "text-gray-300 font-medium mb-2"}, "Taxa Horária (R$)"),
                                React.createElement('input', {type: "number", id: "hourlyRate", value: hourlyRate, onChange: handleHourlyRateChange,
                                    className: "p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 shadow-sm text-gray-100",
                                    step: "0.01", min: "0", "aria-label": "Taxa Horária"})
                            ),
                            React.createElement('div', {className: "flex flex-col"},
                                React.createElement('label', {htmlFor: "selectedYear", className: "text-gray-300 font-medium mb-2"}, "Ano de Cálculo"),
                                React.createElement('input', {type: "number", id: "selectedYear", value: selectedYear, onChange: handleSelectedYearChange,
                                    className: "p-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200 shadow-sm text-gray-100",
                                    min: "1900", max: "2100", "aria-label": "Ano de Cálculo"})
                            )
                        ),

                        React.createElement('div', {className: "text-center mb-6"},
                            React.createElement('button', {onClick: resetAllCalculations,
                                className: "py-2 px-6 bg-red-600 text-white font-bold rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition duration-300"},
                                "Resetar Tudo")
                        ),

                        React.createElement('div', {className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8"},
                            yearlyPeriods.length === 0 && !showMessageBox && (
                                React.createElement('p', {className: "text-gray-400 text-center py-4 col-span-full"}, "Selecione um ano válido para visualizar os períodos de trabalho.")
                            ),
                            yearlyPeriods.map((period, periodIndex) => (
                                React.createElement('div', {key: period.id, className: "bg-gray-700 rounded-lg shadow-md border border-gray-600 overflow-hidden flex flex-col"},
                                    React.createElement('div', {className: "p-4 bg-gray-600 font-semibold text-gray-200 text-lg flex flex-col sm:flex-row items-start sm:items-center justify-between"},
                                        React.createElement('span', {className: "mb-2 sm:mb-0 text-base"}, 
                                            `${period.monthName} (${new Date(period.periodStart.replace(/-/g, '/')).toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit', timeZone: 'UTC'})} a ${new Date(period.periodEnd.replace(/-/g, '/')).toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit', timeZone: 'UTC'})})`
                                        ),
                                        period.monthlySalary > 0 && (
                                            React.createElement('span', {className: "text-blue-300 font-bold text-lg whitespace-nowrap"}, 
                                                `R$ ${period.monthlySalary.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
                                            )
                                        )
                                    ),
                                    React.createElement('div', {className: "p-4 bg-gray-700 border-t border-gray-600 flex-grow flex flex-col justify-between"},
                                        React.createElement('div', null,
                                            React.createElement('div', {className: "mb-4 p-3 bg-gray-800 rounded-md border border-gray-700"},
                                                React.createElement('label', {htmlFor: `quickFill-${period.id}`, className: "block text-gray-300 font-medium mb-2 text-sm"}, "Preencher dias úteis com:"),
                                                React.createElement('div', {className: "flex items-center space-x-2"},
                                                    React.createElement('input', {type: "number", id: `quickFill-${period.id}`, value: period.quickFillHours, onChange: (e) => handleQuickFillHoursChange(periodIndex, e.target.value),
                                                        className: "p-2 bg-gray-700 border border-gray-600 rounded-md w-20 text-center focus:ring-blue-500 focus:border-blue-500 transition duration-200 text-gray-100",
                                                        step: "0.5", min: "0", max: "24", "aria-label": "Preencher horas"}),
                                                    React.createElement('button', {onClick: () => applyQuickFill(periodIndex),
                                                        className: "flex-grow py-2 px-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-200 text-sm"},
                                                        "Preencher Mês")
                                                )
                                            ),
                                            React.createElement('button', {onClick: () => calculateMonthlySalary(periodIndex),
                                                className: "mt-2 w-full py-2 bg-blue-700 text-white font-semibold rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-200"},
                                                "Calcular Salário do Mês")
                                        ),
                                        React.createElement('details', {className: "w-full mt-4 border-t border-gray-600 pt-3"},
                                            React.createElement('summary', {className: "flex items-center p-2 bg-gray-700 hover:bg-gray-700/70 transition duration-200 font-medium text-gray-200 rounded-md cursor-pointer",
                                                onClick: (e) => { toggleMonthExpansion(periodIndex); }},
                                                "Ajustar dias específicos"),
                                            React.createElement('div', {className: "max-h-60 overflow-y-auto pr-1 pt-2 mt-1 space-y-2"}, 
                                                period.days.map((day, dayIndex) => (
                                                    React.createElement('div', {key: day.date, className: "flex flex-col sm:flex-row items-start sm:items-center justify-between p-2 bg-gray-800 rounded-md border border-gray-600"},
                                                        React.createElement('span', {className: "text-gray-300 text-sm font-medium mb-2 sm:mb-0 sm:w-32"},
                                                            `${new Date(day.date.replace(/-/g, '/')).toLocaleDateString('pt-BR', { weekday: 'short', day: '2-digit', month: '2-digit', timeZone: 'UTC' })}`,
                                                            day.isHoliday && React.createElement('span', {className: "text-red-400 ml-1 text-xs"}, "(F)"),
                                                            !day.isWeekday && !day.isHoliday && React.createElement('span', {className: "text-yellow-400 ml-1 text-xs"}, "(FS)")
                                                        ),
                                                        React.createElement('div', {className: "flex items-center space-x-2"},
                                                            React.createElement('label', {className: "text-gray-400 text-sm"}, "Horas:"),
                                                            React.createElement('input', {type: "number", value: day.hours, onChange: (e) => handleDailyHoursChange(periodIndex, dayIndex, e.target.value),
                                                                className: "p-1 bg-gray-700 border border-gray-600 rounded-md w-20 text-center focus:ring-blue-500 focus:border-blue-500 transition duration-200 text-gray-100 text-sm",
                                                                step: "0.5", min: "0", max: "24", "aria-label": `Horas para ${day.date}`})
                                                        )
                                                    )
                                                ))
                                            )
                                        )
                                    )
                                )
                            ))
                        ),

                        React.createElement('button', {onClick: calculateAnnualSalary,
                            className: "w-full py-3 mb-4 bg-green-600 text-white font-bold text-lg rounded-lg shadow-md hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-opacity-50 transition duration-300 transform hover:scale-105",
                            "aria-label": "Calcular Salário Anual", disabled: yearlyPeriods.length === 0},
                            "Calcular Salário Anual Completo"),
                        
                        React.createElement('div', {className: "grid grid-cols-1 md:grid-cols-2 gap-4 mt-6 pt-6 border-t border-gray-700"},
                            React.createElement('button', {onClick: calculateVacation,
                                className: "w-full py-3 bg-teal-600 text-white font-bold text-lg rounded-lg shadow-md hover:bg-teal-500 focus:outline-none focus:ring-2 focus:ring-teal-400 focus:ring-opacity-50 transition duration-300",
                                "aria-label": "Calcular Férias", disabled: yearlyPeriods.length === 0},
                                "Calcular Férias (Estimativa)"),
                            React.createElement('button', {onClick: () => calculateThirteenth(12), // Chama com 12 meses para o modal completo
                                className: "w-full py-3 bg-indigo-600 text-white font-bold text-lg rounded-lg shadow-md hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-opacity-50 transition duration-300",
                                "aria-label": "Calcular 13º Salário", disabled: yearlyPeriods.length === 0},
                                "Calcular 13º Salário (Estimativa)")
                        ),

                        React.createElement('div', {className: "mt-6 pt-6 border-t border-gray-700"},
                             React.createElement('button', {onClick: calculateGrandTotal,
                                className: "w-full py-3 bg-yellow-500 text-gray-900 font-bold text-lg rounded-lg shadow-md hover:bg-yellow-400 focus:outline-none focus:ring-2 focus:ring-yellow-300 focus:ring-opacity-50 transition duration-300 transform hover:scale-105",
                                "aria-label": "Calcular Total Geral Estimado", disabled: yearlyPeriods.length === 0},
                                "Calcular Total Geral Estimado (Salários + Férias + 13º até Ago)")
                        ),


                        annualTotalSalary > 0 && (
                            React.createElement('div', {className: "mt-8 p-6 bg-blue-900/50 border-l-4 border-blue-600 rounded-lg shadow-lg text-center"},
                                React.createElement('h2', {className: "text-2xl font-bold text-blue-300 mb-2"}, "Salário Total Anual Estimado (Apenas Salários):"),
                                React.createElement('p', {className: "text-4xl font-extrabold text-blue-100"},
                                    `R$ ${annualTotalSalary.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
                                )
                            )
                        ),
                        
                        // O grandTotal não precisa ser exibido permanentemente, o modal já faz isso.
                        // Se quiser exibir, descomente abaixo:
                        /*
                        grandTotal > 0 && (
                            React.createElement('div', {className: "mt-8 p-6 bg-yellow-800/50 border-l-4 border-yellow-600 rounded-lg shadow-lg text-center"},
                                React.createElement('h2', {className: "text-2xl font-bold text-yellow-300 mb-2"}, "Total Geral Estimado (Salários + Férias + 13º até Ago):"),
                                React.createElement('p', {className: "text-4xl font-extrabold text-yellow-100"},
                                    `R$ ${grandTotal.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
                                )
                            )
                        ),
                        */

                        showMessageBox && React.createElement(MessageBox, {message: {content: errorMessage}, onClose: () => setShowMessageBox(false), type: "error"}),
                        infoMessageBox.show && React.createElement(MessageBox, {message: {title: infoMessageBox.title, content: infoMessageBox.content}, onClose: () => setInfoMessageBox({show: false, title: '', content: ''}), type: "info"})
                    )
                )
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(React.createElement(App));
    </script>
</body>
</html>

Principais Mudanças:
 * Novo Estado grandTotal:
   * const [grandTotal, setGrandTotal] = React.useState(0); para armazenar o resultado do cálculo total.
 * Função getAverageCalculatedSalary():
   * Uma função auxiliar para calcular a média dos salários mensais que já foram efetivamente calculados (ou seja, monthlySalary > 0). Isso evita que meses não calculados ou com zero horas afetem a média para férias e 13º.
 * Função calculateThirteenth(proportionalMonths = 12) Atualizada:
   * Agora aceita um parâmetro proportionalMonths para calcular o 13º proporcionalmente.
   * Quando chamada pelo botão "Calcular 13º Salário", ela ainda usa proportionalMonths = 12 para mostrar o modal completo.
   * A função agora também retorna um objeto { baseSalary: averageMonthlySalary, thirteenthTotal: thirteenthTotalBrute } para ser usado por outras funções se necessário, embora para o calculateGrandTotal vamos recalcular a parte do 13º diretamente.
 * Nova Função calculateGrandTotal():
   * Calcula a soma dos salários mensais já computados.
   * Calcula a estimativa bruta das férias (média dos salários calculados + 1/3).
   * Calcula a estimativa bruta do 13º salário proporcional a 8 meses (média dos salários calculados / 12 * 8).
   * Soma esses três componentes.
   * Atualiza o estado grandTotal.
   * Exibe um MessageBox informativo com o detalhamento da soma (Salários Mensais + Férias Brutas + 13º Proporcional Bruto).
 * Novo Botão na UI:
   * Adicionado o botão "Calcular Total Geral Estimado (Salários + Férias + 13º até Ago)".
   * Este botão chama a função calculateGrandTotal.
 * Reset:
   * A função resetAllCalculations agora também reseta o grandTotal para 0.
   * Qualquer ação que resete annualTotalSalary (como mudar taxa horária, horas diárias, etc.) também reseta grandTotal.
 * JSX e React.createElement:
   * Mantive a conversão para React.createElement para os elementos JSX, especialmente para o conteúdo do modal, para garantir a compatibilidade.
Agora você terá o novo botão para calcular essa soma geral. Lembre-se que todos esses valores (férias, 13º e, consequentemente, o total geral) são estimativas brutas e não consideram descontos de INSS, IRRF, nem outras particularidades como faltas, adicionais, etc.
